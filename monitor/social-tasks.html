<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæˆä»»åŠ¡ï¼Œå…è´¹é¢†å– 30 å¤© - PiExplorer</title>
    <link rel="icon" href="/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="/" class="flex items-center">
                    <img src="/favicon.png" alt="PiExplorer" class="h-8 w-8 mr-2">
                    <span class="text-xl font-bold text-gray-800">PiExplorer</span>
                </a>
                <div class="flex items-center space-x-4">
                    <a href="/monitor/" class="text-gray-600 hover:text-gray-900">è¿”å›é¦–é¡µ</a>
                    <a href="/auth/login.html" class="text-gray-600 hover:text-gray-900">ç™»å½•</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <div class="gradient-bg text-white py-12">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <h1 class="text-4xl font-bold mb-4">ğŸ å®Œæˆä»»åŠ¡ï¼Œå…è´¹é¢†å– 30 å¤©ç¤¾äº¤ç‰ˆ</h1>
            <p class="text-xl opacity-90">åªéœ€ 3 ä¸ªç®€å•æ­¥éª¤ï¼Œå³å¯è§£é”æ›´å¤šåŠŸèƒ½</p>
        </div>
    </div>

    <!-- ä»»åŠ¡åˆ—è¡¨ -->
    <div class="max-w-4xl mx-auto px-4 py-12">
        <!-- æç¤º -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-yellow-700">
                        è¯·å…ˆ <a href="/auth/register.html" class="font-semibold underline">æ³¨å†Œè´¦æˆ·</a> æˆ– <a href="/auth/login.html" class="font-semibold underline">ç™»å½•</a>ï¼Œç„¶åå®Œæˆä»¥ä¸‹ä»»åŠ¡
                    </p>
                </div>
            </div>
        </div>

        <!-- ä»»åŠ¡è¿›åº¦ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold">ä»»åŠ¡è¿›åº¦</h2>
                <span class="text-gray-600">0/3 å·²å®Œæˆ</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-purple-600 h-3 rounded-full" style="width: 0%"></div>
            </div>
        </div>

        <!-- ä»»åŠ¡ 1 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6" id="task-1">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center text-2xl task-icon">
                        â˜
                    </div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-xl font-semibold mb-2">ä»»åŠ¡ 1ï¼šå…³æ³¨ Twitter @PiexplorerGm</h3>
                    <p class="text-gray-600 mb-4">å…³æ³¨æˆ‘ä»¬çš„ Twitter è´¦å·ï¼Œè·å–æœ€æ–°çš„ Pi Network èµ„è®¯</p>
                    <div class="flex space-x-4">
                        <a href="https://twitter.com/PiexplorerGm" target="_blank" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                            å‰å¾€å…³æ³¨
                        </a>
                        <button class="task-complete-btn border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50 transition" data-task="twitter">
                            æˆ‘å·²å®Œæˆ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä»»åŠ¡ 2 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6" id="task-2">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center text-2xl task-icon">
                        â˜
                    </div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-xl font-semibold mb-2">ä»»åŠ¡ 2ï¼šåŠ å…¥ Telegram ç¾¤ç»„</h3>
                    <p class="text-gray-600 mb-4">åŠ å…¥æˆ‘ä»¬çš„ Telegram ç¤¾åŒºï¼Œä¸å…¶ä»– Pi ç”¨æˆ·äº¤æµ</p>
                    <div class="flex space-x-4">
                        <a href="https://t.me/+GUhbJmYybCRjYmZl" target="_blank" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                            åŠ å…¥ç¾¤ç»„
                        </a>
                        <button class="task-complete-btn border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50 transition" data-task="telegram">
                            æˆ‘å·²å®Œæˆ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä»»åŠ¡ 3 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6" id="task-3">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center text-2xl task-icon">
                        â˜
                    </div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-xl font-semibold mb-2">ä»»åŠ¡ 3ï¼šè½¬å‘æŒ‡å®šæ¨æ–‡</h3>
                    <p class="text-gray-600 mb-4">è½¬å‘æˆ‘ä»¬çš„æ¨æ–‡å¹¶ @3 ä½å¥½å‹</p>
                    <div class="flex space-x-4">
                        <a href="https://twitter.com/PiexplorerGm" target="_blank" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                            æŸ¥çœ‹æ¨æ–‡
                        </a>
                        <button class="task-complete-btn border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50 transition" data-task="retweet">
                            æˆ‘å·²å®Œæˆ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¥–åŠ±è¯´æ˜ -->
        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-semibold mb-4">ğŸ å®Œæˆæ‰€æœ‰ä»»åŠ¡åï¼Œæ‚¨å°†è·å¾—ï¼š</h3>
            <ul class="space-y-2">
                <li class="flex items-start">
                    <svg class="h-6 w-6 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>3 ä¸ªç›‘æ§åœ°å€ï¼ˆåŸ 1 ä¸ªï¼‰</span>
                </li>
                <li class="flex items-start">
                    <svg class="h-6 w-6 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>è‡ªå®šä¹‰é˜ˆå€¼åŠŸèƒ½</span>
                </li>
                <li class="flex items-start">
                    <svg class="h-6 w-6 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>30 å¤©æœ‰æ•ˆæœŸ</span>
                </li>
            </ul>
        </div>

        <!-- éªŒè¯æŒ‰é’® -->
        <div class="text-center">
            <button id="claim-btn" class="gradient-bg text-white px-8 py-3 rounded-lg font-semibold opacity-50 cursor-not-allowed" disabled>
                éªŒè¯å¹¶é¢†å–ï¼ˆè¯·å…ˆå®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼‰
            </button>
            <p id="claim-message" class="mt-4 text-gray-600">
                è¯·å®Œæˆä¸Šè¿°æ‰€æœ‰ä»»åŠ¡åç‚¹å‡»éªŒè¯
            </p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p>&copy; 2024 PiExplorer. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // API åŸºç¡€ URL
        const API_BASE_URL = 'https://api.piexplorer.online';

        // ä»»åŠ¡çŠ¶æ€ç®¡ç†
        const taskStatus = {
            twitter: false,
            telegram: false,
            retweet: false
        };

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€å’Œä»»åŠ¡çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadTaskStatus();
            initTaskButtons();
            updateClaimButton();
        });

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('è¯·å…ˆç™»å½•ï¼');
                window.location.href = '/auth/login.html';
                return;
            }
        }

        // åŠ è½½ä»»åŠ¡çŠ¶æ€
        function loadTaskStatus() {
            const saved = localStorage.getItem('socialTaskStatus');
            if (saved) {
                const savedStatus = JSON.parse(saved);
                Object.assign(taskStatus, savedStatus);
                updateTaskUI();
            }
        }

        // ä¿å­˜ä»»åŠ¡çŠ¶æ€
        function saveTaskStatus() {
            localStorage.setItem('socialTaskStatus', JSON.stringify(taskStatus));
        }

        // åˆå§‹åŒ–ä»»åŠ¡æŒ‰é’®
        function initTaskButtons() {
            const buttons = document.querySelectorAll('.task-complete-btn');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    const taskType = this.getAttribute('data-task');
                    markTaskComplete(taskType, this);
                });
            });

            // éªŒè¯å¹¶é¢†å–æŒ‰é’®
            document.getElementById('claim-btn').addEventListener('click', claimReward);
        }

        // æ ‡è®°ä»»åŠ¡å®Œæˆ
        function markTaskComplete(taskType, button) {
            if (taskStatus[taskType]) {
                alert('æ‚¨å·²ç»å®Œæˆè¿‡è¿™ä¸ªä»»åŠ¡äº†ï¼');
                return;
            }

            if (confirm('ç¡®è®¤æ‚¨å·²å®Œæˆæ­¤ä»»åŠ¡ï¼Ÿ\n\næ³¨æ„ï¼šè™šå‡æäº¤å¯èƒ½å¯¼è‡´å¥–åŠ±è¢«å–æ¶ˆã€‚')) {
                taskStatus[taskType] = true;
                saveTaskStatus();
                updateTaskUI();
                updateClaimButton();

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                button.textContent = 'âœ“ å·²å®Œæˆ';
                button.classList.add('bg-green-500', 'text-white', 'border-green-500');
                button.disabled = true;
            }
        }

        // æ›´æ–°ä»»åŠ¡ UI
        function updateTaskUI() {
            Object.keys(taskStatus).forEach((taskType, index) => {
                if (taskStatus[taskType]) {
                    const taskCard = document.getElementById(`task-${index + 1}`);
                    const icon = taskCard.querySelector('.task-icon');
                    const button = taskCard.querySelector('.task-complete-btn');

                    icon.textContent = 'âœ“';
                    icon.classList.remove('bg-gray-200');
                    icon.classList.add('bg-green-500', 'text-white');

                    button.textContent = 'âœ“ å·²å®Œæˆ';
                    button.classList.add('bg-green-500', 'text-white', 'border-green-500');
                    button.disabled = true;
                }
            });
        }

        // æ›´æ–°é¢†å–æŒ‰é’®çŠ¶æ€
        function updateClaimButton() {
            const allCompleted = Object.values(taskStatus).every(status => status === true);
            const claimBtn = document.getElementById('claim-btn');
            const claimMessage = document.getElementById('claim-message');

            if (allCompleted) {
                claimBtn.disabled = false;
                claimBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                claimBtn.classList.add('hover:opacity-90', 'cursor-pointer');
                claimBtn.textContent = 'éªŒè¯å¹¶é¢†å–å¥–åŠ±';
                claimMessage.textContent = 'æ­å–œï¼æ‚¨å·²å®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼Œç‚¹å‡»æŒ‰é’®é¢†å–å¥–åŠ±';
                claimMessage.classList.add('text-green-600', 'font-semibold');
            }
        }

        // é¢†å–å¥–åŠ±
        async function claimReward() {
            const token = localStorage.getItem('token');
            const claimBtn = document.getElementById('claim-btn');
            const claimMessage = document.getElementById('claim-message');

            // æ£€æŸ¥æ˜¯å¦å·²é¢†å–
            const claimed = localStorage.getItem('socialTaskClaimed');
            if (claimed === 'true') {
                alert('æ‚¨å·²ç»é¢†å–è¿‡å¥–åŠ±äº†ï¼');
                return;
            }

            claimBtn.disabled = true;
            claimBtn.textContent = 'éªŒè¯ä¸­...';
            claimMessage.textContent = 'æ­£åœ¨éªŒè¯æ‚¨çš„ä»»åŠ¡å®Œæˆæƒ…å†µï¼Œè¯·ç¨å€™...';

            try {
                const response = await fetch(`${API_BASE_URL}/api/social-tasks/claim`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        tasks: taskStatus
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    localStorage.setItem('socialTaskClaimed', 'true');
                    claimBtn.textContent = 'âœ“ å·²é¢†å–';
                    claimBtn.classList.add('bg-green-600');
                    claimMessage.textContent = 'ğŸ‰ æ­å–œï¼å¥–åŠ±å·²å‘æ”¾åˆ°æ‚¨çš„è´¦æˆ·';
                    claimMessage.classList.add('text-green-600', 'font-bold');

                    alert('ğŸ‰ æ­å–œï¼\n\næ‚¨å·²æˆåŠŸé¢†å–å¥–åŠ±ï¼š\nâ€¢ 3 ä¸ªç›‘æ§åœ°å€\nâ€¢ è‡ªå®šä¹‰é˜ˆå€¼åŠŸèƒ½\nâ€¢ 30 å¤©æœ‰æ•ˆæœŸ\n\nè¯·å‰å¾€ç›‘æ§é¡µé¢å¼€å§‹ä½¿ç”¨ï¼');

                    // 3ç§’åè·³è½¬åˆ°ç›‘æ§é¡µé¢
                    setTimeout(() => {
                        window.location.href = '/monitor/';
                    }, 3000);
                } else {
                    throw new Error(data.message || 'é¢†å–å¤±è´¥');
                }
            } catch (error) {
                console.error('é¢†å–å¥–åŠ±å¤±è´¥:', error);
                claimBtn.disabled = false;
                claimBtn.textContent = 'éªŒè¯å¹¶é¢†å–å¥–åŠ±';
                claimMessage.textContent = 'é¢†å–å¤±è´¥ï¼š' + error.message + 'ï¼Œè¯·ç¨åé‡è¯•';
                claimMessage.classList.add('text-red-600');
                alert('é¢†å–å¤±è´¥ï¼š' + error.message);
            }
        }
    </script>
</body>
</html>

