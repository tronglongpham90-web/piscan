<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>社交任务 - PiExplorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex">
        <!-- 侧边栏 -->
        <aside class="w-64 bg-white shadow-lg">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-purple-600">PiExplorer</h1>
                <p class="text-sm text-gray-500 mt-1">钱包监控系统</p>
            </div>
            
            <nav class="mt-6">
                <a href="/monitor/dashboard.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-purple-50 hover:text-purple-600">
                    <span class="text-xl mr-3">📊</span>
                    <span>仪表板</span>
                </a>
                <a href="/monitor/add-monitor.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-purple-50 hover:text-purple-600">
                    <span class="text-xl mr-3">➕</span>
                    <span>添加监控</span>
                </a>
                <a href="/monitor/notifications.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-purple-50 hover:text-purple-600">
                    <span class="text-xl mr-3">🔔</span>
                    <span>通知历史</span>
                </a>
                <!-- 推荐返现功能暂时隐藏 -->
                <!-- <a href="/monitor/referral.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-purple-50 hover:text-purple-600">
                    <span class="text-xl mr-3">💰</span>
                    <span>推荐返现</span>
                </a> -->
                <a href="/monitor/settings.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-purple-50 hover:text-purple-600">
                    <span class="text-xl mr-3">⚙️</span>
                    <span>账户设置</span>
                </a>
                <a href="/monitor/social-tasks.html" class="flex items-center px-6 py-3 bg-purple-50 text-purple-600 border-r-4 border-purple-600">
                    <span class="text-xl mr-3">🎯</span>
                    <span>社交任务</span>
                </a>
                <a href="/monitor/upgrade.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-purple-50 hover:text-purple-600">
                    <span class="text-xl mr-3">⭐</span>
                    <span>升级会员</span>
                </a>
            </nav>

            <div class="absolute bottom-0 w-64 p-6 border-t">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-900" id="user-email">用户</p>
                        <p class="text-xs text-gray-500">免费版</p>
                    </div>
                    <button id="logout-btn" class="text-red-600 hover:text-red-700">
                        <span class="text-xl">🚪</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="flex-1 p-8">
            <div class="max-w-6xl mx-auto">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800">社交任务</h2>
                    <p class="text-gray-600 mt-2">完成任务，免费解锁会员功能</p>
                </div>

                <!-- 兑换码卡片 -->
                <div class="bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl shadow-lg p-8 mb-8 text-white">
                    <div class="mb-6">
                        <h3 class="text-2xl font-bold">🎁 兑换码激活</h3>
                        <p class="text-purple-100 mt-1">输入兑换码，立即获得 1 个月会员（可监控 3 个地址）</p>
                    </div>
                    <div class="flex gap-4">
                        <input
                            type="text"
                            id="redeem-code-input"
                            placeholder="请输入兑换码"
                            class="flex-1 px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-white"
                        />
                        <button
                            onclick="redeemCode()"
                            class="px-8 py-3 bg-white text-purple-600 font-semibold rounded-lg hover:bg-purple-50 transition-all"
                        >
                            兑换
                        </button>
                    </div>
                </div>

                <!-- 获取兑换码说明 -->
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">📢 如何获取兑换码？</h3>
                    <p class="text-gray-600 mb-6">加入我们的社群，即可免费领取兑换码！</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- QQ 群 -->
                        <div class="bg-white rounded-xl shadow-md p-6 border-2 border-purple-200 hover:border-purple-400 transition-all">
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="text-5xl">💬</div>
                                <div>
                                    <h3 class="font-bold text-gray-900 text-lg">加入 QQ 群</h3>
                                    <p class="text-sm text-gray-500">加入群聊，领取兑换码</p>
                                </div>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-4 mb-4">
                                <p class="text-sm text-gray-600 mb-2">QQ 群号：</p>
                                <p class="text-2xl font-bold text-purple-600">637147324</p>
                            </div>
                            <button onclick="window.open('https://qm.qq.com/cgi-bin/qm/qr?k=637147324', '_blank')" class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold transition-all">
                                立即加入 QQ 群
                            </button>
                        </div>

                        <!-- Telegram 群 -->
                        <div class="bg-white rounded-xl shadow-md p-6 border-2 border-purple-200 hover:border-purple-400 transition-all">
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="text-5xl">✈️</div>
                                <div>
                                    <h3 class="font-bold text-gray-900 text-lg">加入 Telegram 群</h3>
                                    <p class="text-sm text-gray-500">加入群聊，领取兑换码</p>
                                </div>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-4 mb-4">
                                <p class="text-sm text-gray-600 mb-2">Telegram 群组：</p>
                                <p class="text-lg font-bold text-purple-600">@piexplorer</p>
                            </div>
                            <button onclick="window.open('https://t.me/piexplorer', '_blank')" class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold transition-all">
                                立即加入 Telegram 群
                            </button>
                        </div>
                    </div>

                    <!-- 使用说明 -->
                    <div class="mt-8 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl shadow-md p-6 border-2 border-yellow-200">
                        <div class="flex items-start space-x-4">
                            <div class="text-5xl">💡</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-900 mb-3">使用兑换码，立即获得会员权益！</h3>
                                <ul class="space-y-2 text-gray-700">
                                    <li class="flex items-center space-x-2">
                                        <span class="text-green-600">✓</span>
                                        <span>监控数量上限提升至 <strong>3 个</strong></span>
                                    </li>
                                    <li class="flex items-center space-x-2">
                                        <span class="text-green-600">✓</span>
                                        <span>会员有效期 <strong>30 天</strong></span>
                                    </li>
                                </ul>
                                <div class="mt-4 p-4 bg-white rounded-lg border border-yellow-300">
                                    <p class="text-sm text-gray-600">
                                        <strong>📌 温馨提示：</strong>加入 QQ 群或 Telegram 群后，在群公告中可以找到兑换码。每个兑换码只能使用一次。
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </main>
    </div>

    <script>
        const API_BASE_URL = 'https://piexplorer-api.vercel.app';
        const VERCEL_BYPASS_TOKEN = 'q9Ad6yNz2v787XKcQ1uE0Q8H0NxNddZW';

        // 检查登录状态
        function checkAuth() {
            const token = localStorage.getItem('token');
            const userEmail = localStorage.getItem('userEmail');
            
            if (!token || !userEmail) {
                window.location.href = '/auth/login.html';
                return false;
            }
            
            document.getElementById('user-email').textContent = userEmail;
            return true;
        }

        // 退出登录
        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('token');
            localStorage.removeItem('userEmail');
            window.location.href = '/auth/login.html';
        });

        // 兑换码功能
        async function redeemCode() {
            if (!checkAuth()) return;

            const codeInput = document.getElementById('redeem-code-input');
            const code = codeInput.value.trim();

            if (!code) {
                alert('❌ 请输入兑换码');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE_URL}/api/social-tasks?action=redeem`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                        'x-vercel-protection-bypass': VERCEL_BYPASS_TOKEN
                    },
                    body: JSON.stringify({ code })
                });

                const data = await response.json();

                if (data.success) {
                    alert('🎉 兑换成功！您已获得 30 天会员，可以监控 3 个地址！');
                    codeInput.value = '';
                    // 跳转到仪表板
                    setTimeout(() => {
                        window.location.href = '/monitor/dashboard.html';
                    }, 1500);
                } else {
                    alert('❌ ' + (data.message || '兑换失败，请检查兑换码是否正确'));
                }
            } catch (error) {
                console.error('兑换失败:', error);
                alert('❌ 兑换失败，请稍后重试');
            }
        }

        // 回车键兑换
        document.getElementById('redeem-code-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                redeemCode();
            }
        });

        // 页面加载时执行
        window.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });
    </script>
</body>
</html>
