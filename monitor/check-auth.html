<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¤è¯æ£€æŸ¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-4">ğŸ” è®¤è¯çŠ¶æ€æ£€æŸ¥</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-4">
            <h2 class="text-lg font-semibold mb-2">Token çŠ¶æ€</h2>
            <div id="tokenStatus" class="space-y-2"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-lg font-semibold mb-2">æ“ä½œ</h2>
            <div class="space-x-2">
                <button onclick="goToLogin()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    å»ç™»å½•
                </button>
                <button onclick="clearToken()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    æ¸…é™¤ Token
                </button>
                <button onclick="location.reload()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    åˆ·æ–°æ£€æŸ¥
                </button>
            </div>
        </div>
    </div>

    <script>
        const tokenStatus = document.getElementById('tokenStatus');

        function checkAuth() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');

            let html = '';

            if (!token) {
                html += '<div class="text-red-600 font-bold">âŒ æœªæ‰¾åˆ°ç™»å½• Token</div>';
                html += '<div class="text-sm text-gray-600">ä½ éœ€è¦å…ˆç™»å½•æ‰èƒ½ä½¿ç”¨ç›‘æ§åŠŸèƒ½</div>';
            } else {
                html += '<div class="text-green-600 font-bold">âœ… æ‰¾åˆ° Token</div>';
                html += `<div class="text-xs text-gray-600 break-all">Token: ${token.substring(0, 50)}...</div>`;
                
                // å°è¯•è§£æ JWT
                try {
                    const parts = token.split('.');
                    if (parts.length === 3) {
                        const payload = JSON.parse(atob(parts[1]));
                        html += '<div class="mt-2 text-sm">';
                        html += '<div class="font-semibold">Token å†…å®¹:</div>';
                        html += `<pre class="bg-gray-100 p-2 rounded text-xs">${JSON.stringify(payload, null, 2)}</pre>`;
                        
                        // æ£€æŸ¥è¿‡æœŸæ—¶é—´
                        if (payload.exp) {
                            const expDate = new Date(payload.exp * 1000);
                            const now = new Date();
                            if (expDate < now) {
                                html += '<div class="text-red-600 mt-2">âš ï¸ Token å·²è¿‡æœŸï¼</div>';
                                html += `<div class="text-sm text-gray-600">è¿‡æœŸæ—¶é—´: ${expDate.toLocaleString()}</div>`;
                            } else {
                                html += '<div class="text-green-600 mt-2">âœ… Token ä»ç„¶æœ‰æ•ˆ</div>';
                                html += `<div class="text-sm text-gray-600">è¿‡æœŸæ—¶é—´: ${expDate.toLocaleString()}</div>`;
                            }
                        }
                        html += '</div>';
                    }
                } catch (e) {
                    html += '<div class="text-yellow-600 mt-2">âš ï¸ æ— æ³•è§£æ Token (å¯èƒ½æ ¼å¼ä¸æ­£ç¡®)</div>';
                }
            }

            if (user) {
                html += '<div class="mt-4">';
                html += '<div class="text-green-600 font-bold">âœ… æ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯</div>';
                html += `<pre class="bg-gray-100 p-2 rounded text-xs mt-2">${user}</pre>`;
                html += '</div>';
            } else {
                html += '<div class="mt-4 text-yellow-600">âš ï¸ æœªæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯</div>';
            }

            tokenStatus.innerHTML = html;
        }

        function goToLogin() {
            window.location.href = '/auth/login.html';
        }

        function clearToken() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            alert('Token å·²æ¸…é™¤');
            location.reload();
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥
        checkAuth();
    </script>
</body>
</html>

