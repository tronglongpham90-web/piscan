<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>完成任务，免费领取 30 天 - PiExplorer</title>
    <link rel="icon" href="/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="/" class="flex items-center">
                    <img src="/favicon.png" alt="PiExplorer" class="h-8 w-8 mr-2">
                    <span class="text-xl font-bold text-gray-800">PiExplorer</span>
                </a>
                <div class="flex items-center space-x-4">
                    <a href="/monitor/" class="text-gray-600 hover:text-gray-900">返回首页</a>
                    <a href="/auth/login.html" class="text-gray-600 hover:text-gray-900">登录</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <div class="gradient-bg text-white py-12">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <h1 class="text-4xl font-bold mb-4">🎁 完成任务，免费领取 30 天社交版</h1>
            <p class="text-xl opacity-90">只需 3 个简单步骤，即可解锁更多功能</p>
        </div>
    </div>

    <!-- 任务列表 -->
    <div class="max-w-4xl mx-auto px-4 py-12">
        <!-- 提示 -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-yellow-700">
                        请先 <a href="/auth/register.html" class="font-semibold underline">注册账户</a> 或 <a href="/auth/login.html" class="font-semibold underline">登录</a>，然后完成以下任务
                    </p>
                </div>
            </div>
        </div>

        <!-- 任务进度 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold">任务进度</h2>
                <span class="text-gray-600">0/3 已完成</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-purple-600 h-3 rounded-full" style="width: 0%"></div>
            </div>
        </div>

        <!-- 任务 1 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6" id="task-1">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center text-2xl task-icon">
                        ☐
                    </div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-xl font-semibold mb-2">任务 1：关注 Twitter @PiexplorerGm</h3>
                    <p class="text-gray-600 mb-4">关注我们的 Twitter 账号，获取最新的 Pi Network 资讯</p>
                    <div class="flex space-x-4">
                        <a href="https://twitter.com/PiexplorerGm" target="_blank" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                            前往关注
                        </a>
                        <button class="task-complete-btn border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50 transition" data-task="twitter">
                            我已完成
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 任务 2 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6" id="task-2">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center text-2xl task-icon">
                        ☐
                    </div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-xl font-semibold mb-2">任务 2：加入 Telegram 群组</h3>
                    <p class="text-gray-600 mb-4">加入我们的 Telegram 社区，与其他 Pi 用户交流</p>
                    <div class="flex space-x-4">
                        <a href="https://t.me/+GUhbJmYybCRjYmZl" target="_blank" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                            加入群组
                        </a>
                        <button class="task-complete-btn border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50 transition" data-task="telegram">
                            我已完成
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 任务 3 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6" id="task-3">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center text-2xl task-icon">
                        ☐
                    </div>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-xl font-semibold mb-2">任务 3：转发指定推文</h3>
                    <p class="text-gray-600 mb-4">转发我们的推文并 @3 位好友</p>
                    <div class="flex space-x-4">
                        <a href="https://twitter.com/PiexplorerGm" target="_blank" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                            查看推文
                        </a>
                        <button class="task-complete-btn border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50 transition" data-task="retweet">
                            我已完成
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 奖励说明 -->
        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-semibold mb-4">🎁 完成所有任务后，您将获得：</h3>
            <ul class="space-y-2">
                <li class="flex items-start">
                    <svg class="h-6 w-6 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>3 个监控地址（原 1 个）</span>
                </li>
                <li class="flex items-start">
                    <svg class="h-6 w-6 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>自定义阈值功能</span>
                </li>
                <li class="flex items-start">
                    <svg class="h-6 w-6 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>30 天有效期</span>
                </li>
            </ul>
        </div>

        <!-- 验证按钮 -->
        <div class="text-center">
            <button id="claim-btn" class="gradient-bg text-white px-8 py-3 rounded-lg font-semibold opacity-50 cursor-not-allowed" disabled>
                验证并领取（请先完成所有任务）
            </button>
            <p id="claim-message" class="mt-4 text-gray-600">
                请完成上述所有任务后点击验证
            </p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p>&copy; 2024 PiExplorer. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // API 基础 URL
        const API_BASE_URL = 'https://api.piexplorer.online';

        // 任务状态管理
        const taskStatus = {
            twitter: false,
            telegram: false,
            retweet: false
        };

        // 页面加载时检查登录状态和任务状态
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadTaskStatus();
            initTaskButtons();
            updateClaimButton();
        });

        // 检查登录状态
        function checkLoginStatus() {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('请先登录！');
                window.location.href = '/auth/login.html';
                return;
            }
        }

        // 加载任务状态
        function loadTaskStatus() {
            const saved = localStorage.getItem('socialTaskStatus');
            if (saved) {
                const savedStatus = JSON.parse(saved);
                Object.assign(taskStatus, savedStatus);
                updateTaskUI();
            }
        }

        // 保存任务状态
        function saveTaskStatus() {
            localStorage.setItem('socialTaskStatus', JSON.stringify(taskStatus));
        }

        // 初始化任务按钮
        function initTaskButtons() {
            const buttons = document.querySelectorAll('.task-complete-btn');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    const taskType = this.getAttribute('data-task');
                    markTaskComplete(taskType, this);
                });
            });

            // 验证并领取按钮
            document.getElementById('claim-btn').addEventListener('click', claimReward);
        }

        // 标记任务完成
        function markTaskComplete(taskType, button) {
            if (taskStatus[taskType]) {
                alert('您已经完成过这个任务了！');
                return;
            }

            if (confirm('确认您已完成此任务？\n\n注意：虚假提交可能导致奖励被取消。')) {
                taskStatus[taskType] = true;
                saveTaskStatus();
                updateTaskUI();
                updateClaimButton();

                // 显示成功提示
                button.textContent = '✓ 已完成';
                button.classList.add('bg-green-500', 'text-white', 'border-green-500');
                button.disabled = true;
            }
        }

        // 更新任务 UI
        function updateTaskUI() {
            Object.keys(taskStatus).forEach((taskType, index) => {
                if (taskStatus[taskType]) {
                    const taskCard = document.getElementById(`task-${index + 1}`);
                    const icon = taskCard.querySelector('.task-icon');
                    const button = taskCard.querySelector('.task-complete-btn');

                    icon.textContent = '✓';
                    icon.classList.remove('bg-gray-200');
                    icon.classList.add('bg-green-500', 'text-white');

                    button.textContent = '✓ 已完成';
                    button.classList.add('bg-green-500', 'text-white', 'border-green-500');
                    button.disabled = true;
                }
            });
        }

        // 更新领取按钮状态
        function updateClaimButton() {
            const allCompleted = Object.values(taskStatus).every(status => status === true);
            const claimBtn = document.getElementById('claim-btn');
            const claimMessage = document.getElementById('claim-message');

            if (allCompleted) {
                claimBtn.disabled = false;
                claimBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                claimBtn.classList.add('hover:opacity-90', 'cursor-pointer');
                claimBtn.textContent = '验证并领取奖励';
                claimMessage.textContent = '恭喜！您已完成所有任务，点击按钮领取奖励';
                claimMessage.classList.add('text-green-600', 'font-semibold');
            }
        }

        // 领取奖励
        async function claimReward() {
            const token = localStorage.getItem('token');
            const claimBtn = document.getElementById('claim-btn');
            const claimMessage = document.getElementById('claim-message');

            // 检查是否已领取
            const claimed = localStorage.getItem('socialTaskClaimed');
            if (claimed === 'true') {
                alert('您已经领取过奖励了！');
                return;
            }

            claimBtn.disabled = true;
            claimBtn.textContent = '验证中...';
            claimMessage.textContent = '正在验证您的任务完成情况，请稍候...';

            try {
                const response = await fetch(`${API_BASE_URL}/api/social-tasks/claim`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        tasks: taskStatus
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    localStorage.setItem('socialTaskClaimed', 'true');
                    claimBtn.textContent = '✓ 已领取';
                    claimBtn.classList.add('bg-green-600');
                    claimMessage.textContent = '🎉 恭喜！奖励已发放到您的账户';
                    claimMessage.classList.add('text-green-600', 'font-bold');

                    alert('🎉 恭喜！\n\n您已成功领取奖励：\n• 3 个监控地址\n• 自定义阈值功能\n• 30 天有效期\n\n请前往监控页面开始使用！');

                    // 3秒后跳转到监控页面
                    setTimeout(() => {
                        window.location.href = '/monitor/';
                    }, 3000);
                } else {
                    throw new Error(data.message || '领取失败');
                }
            } catch (error) {
                console.error('领取奖励失败:', error);
                claimBtn.disabled = false;
                claimBtn.textContent = '验证并领取奖励';
                claimMessage.textContent = '领取失败：' + error.message + '，请稍后重试';
                claimMessage.classList.add('text-red-600');
                alert('领取失败：' + error.message);
            }
        }
    </script>
</body>
</html>

